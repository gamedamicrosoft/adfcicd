name: Deploy ADF and Databricks

on:
  push:
    branches:
      - main
      - qa

jobs:
  deploy-databricks-notebooks:
    name: Deploy Notebooks to Databricks
    runs-on: ubuntu-latest # Use your self-hosted runner
    # Dynamically select environment based on branch
    environment: ${{ github.ref_name == 'main' && 'dev' || 'qa' }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Databricks CLI
        run: pip install databricks-cli

      - name: Deploy Notebooks to Databricks
        env:
          LOCAL_NOTEBOOKS_DIR: ${{ github.workspace }}/databricks/notebooks
          DATABRICKS_HOST: https://${{ vars.DATABRICKS_URL }}
          DATABRICKS_WORKSPACE_DIR: ${{ vars.DATABRICKS_WORKSPACE_DIR }}
          DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}

        run: |
          echo "DATABRICKS_HOST= ${DATABRICKS_HOST}"
          databricks workspace import_dir "$LOCAL_NOTEBOOKS_DIR" "$DATABRICKS_WORKSPACE_DIR" --overwrite

